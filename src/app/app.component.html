<div class="containerDiv" fxFill fxLayout="column" fxLayout.xs="column" fxLayoutAlign="center none"
    fxLayoutAlign.xs="center none" fxLayoutGap="20px" fxLayoutGap.xs="20px">
    <div class="headingDiv">
        <h2>Hospital Usage Statistics of West Bengal</h2>
    </div>
    <div class="mat-elevation-z8 bar">
        <input class="searchbar" type="text" title="Search" (keyup)="applyFilter($event.target.value)"
            placeholder="Hospital Name/Locality" [(ngModel)]="searchBar">
        <mat-icon matSuffix class="searchIcon">search</mat-icon>
    </div>

    <div *ngIf="!DATA" fxLayoutAlign="center center">
        <mat-spinner style="margin-top: 10%;"></mat-spinner>
    </div>
    <div class="filterDiv" style="position: fixed;top:9.0rem;left: 2.0rem;">
        <form class="example-form">
            <mat-form-field class="dropDown">
              <input type="text"
                     placeholder="District"
                     matInput
                     [formControl]="myControl"
                     [matAutocomplete]="auto"
                     name="districtFilter" 
                     (keyup)="applyFilter($event.value)">
              <mat-autocomplete #auto="matAutocomplete" (optionSelected)="applyFilter($event.value)">
                <mat-option *ngFor="let option of filteredOptions | async" [value]="option">
                  {{option}}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>          
            <mat-form-field appearance="legacy" class="dropDown">
                <mat-label>Hospital Type</mat-label>
                <mat-select [(ngModel)]="filterByHospitalTypeDropDown" name="hospitalTypeFilter"
                    (selectionChange)="applyFilter($event.value)">
                    <mat-option value=" ">Both</mat-option>
                    <mat-option [value]="true">Private</mat-option>
                    <mat-option [value]="false">Govt.</mat-option>
                </mat-select>
            </mat-form-field>
            &nbsp;
            <button mat-raised-button color="primary" (click)="resetFilters()"
                style="background-color: #746f7b;border-radius: 20px;">Reset</button>
        </form>
        <!-- <mat-form-field appearance="legacy" class="dropDown">
            <mat-label>District</mat-label>
            <mat-select [(ngModel)]="filterByDistrictDropDown" name="districtFilter" (selectionChange)="applyFilter($event.value)">
                <mat-option value=" "></mat-option>
                <mat-option *ngFor="let ele of districtList" [value]="ele">{{ele}}</mat-option>
            </mat-select>
        </mat-form-field> -->

    </div>
    <div style="text-align: right;margin-right: 20px;position: fixed;top: 12.0rem;">
        <span>
            <span class="iconify" data-icon="vaadin:exclamation" data-inline="false" data-width="20"
                data-height="20"></span>Click on rows to view more details
        </span>
    </div>
    <div class="table-container">
        <mat-card *ngIf="dataSource?.filteredData" class="table-card">
            <div class="mat-elevation-z8">
                <table mat-table [dataSource]="dataSource" multiTemplateDataRows id="matTable">

                    <!-- NAME Column -->
                    <ng-container matColumnDef="name">
                        <th mat-header-cell *matHeaderCellDef> NAME </th>
                        <td mat-cell *matCellDef="let row"> {{row.name}} </td>
                    </ng-container>

                    <!-- TOTAL BED CAPACITY Column -->
                    <ng-container matColumnDef="totalBedCapacity">
                        <th mat-header-cell *matHeaderCellDef> TOTAL BED CAPACITY </th>
                        <td mat-cell *matCellDef="let row"> {{row.usage.totalBedCapacity}}</td>
                    </ng-container>

                    <!-- VACANT BED COUNT Column -->
                    <ng-container matColumnDef="vacantBeds">
                        <th mat-header-cell *matHeaderCellDef> VACANT BED COUNT </th>
                        <td mat-cell *matCellDef="let row"> {{row.usage.vacantBeds}} </td>
                    </ng-container>

                    <!-- PHONE NUMBER Column -->
                    <ng-container matColumnDef="phoneNumber">
                        <th mat-header-cell *matHeaderCellDef> PHONE NUMBER </th>
                        <td mat-cell *matCellDef="let row" id="phoneNumberRow">
                             <a href="tel:{{row.contact.phone}}">{{row.contact.phone}}</a></td>
                        </ng-container>

                    <!-- Is Private Column -->
                    <ng-container matColumnDef="isPrivate">
                        <th mat-header-cell *matHeaderCellDef></th>
                        <td mat-cell *matCellDef="let row">
                            <mat-chip *ngIf="row.isPrivate===true">Pvt.</mat-chip>
                            <mat-chip *ngIf="row.isPrivate===false">Govt.</mat-chip>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="expandedDetail">
                        <td mat-cell *matCellDef="let element" [attr.colspan]="columnsToDisplay.length">
                            <div class="element-detail"
                                [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">
                                <div class="element-description">
                                    <div fxLayout="row wrap" fxLayout.xs="row wrap" fxLayoutGap.xs="10px"
                                        fxLayoutGap="10px">
                                        <div fxLayout.xs="row" fxLayout="row" class="detailSubDiv">
                                            <span class="iconify" data-icon="bx:bx-map" data-inline="false"
                                                data-width="40" data-height="40"></span>
                                            <span id="addressLine">{{element.contact.addressLine}}</span>
                                        </div>
                                        <div *ngIf="element.additionalInfo" fxLayout.xs="row" fxLayout="row"
                                            class="detailSubDiv">
                                            <span class="iconify info_icon" data-icon="el:info-circle"
                                                data-inline="false" data-width="24" data-height="24"></span>
                                            <span class="otherInformation">{{element.additionalInfo}}</span>
                                        </div>
                                        <div fxLayout.xs="row" fxLayout="row" class="detailSubDiv">
                                            <span class="iconify info_icon" data-icon="bi:calendar-date"
                                                data-inline="false" data-width="24" data-height="24"></span>
                                            <span class="otherInformation">Updated On
                                                {{element.usage.lastUpdated}}</span>
                                        </div>
                                        <!-- <div *ngIf="screenSizeLarge == true" fxLayout.xs="row" fxLayout="row"
                                            class="detailSubDiv">
                                            <span>Total Bed Capacity</span>
                                            &nbsp;
                                            <span class="otherInformation">{{element.usage.totalBedCapacity}}</span>
                                        </div> -->
                                    </div>
                                </div>
                            </div>
                        </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="columnsToDisplay; sticky: true"></tr>
                    <tr mat-row *matRowDef="let element; columns: columnsToDisplay;" class="element-row"
                        [class.expanded-row]="expandedElement === element"
                        (click)="expandedElement = expandedElement === element ? null : element"
                        [ngStyle]="{'background-color':element.usage.usagePercentage >= 90 ? '#ff9999' : '#ffffff' }">
                    </tr>
                    <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="detail-row"></tr>
                </table>
            </div>
            <div style="">
                <span style="margin-right :20px">
                    <span class="iconify" data-icon="maki:information-11" data-inline="false" data-width="20"
                        data-height="20" style="margin-top: 5px;"></span>
                    Information as per wbhealth.gov.in
                </span>
                <span>
                    <span class="iconify" data-icon="ion:share-social-sharp" data-inline="false" data-width="20"
                        data-height="20"></span>
                    A social IT initiative
                </span>
            </div>
        </mat-card>

    </div>
    <div class="footer">
        <mat-paginator [pageSizeOptions]="[8, 25, 50, 100] " style="height: 50px;"></mat-paginator>
    </div>
</div>